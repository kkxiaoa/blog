<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>类继承 | KKXiao的blog</title>
    <meta name="description" content="热爱前端，拥抱开源，不止前端">
    <meta name="generator" content="VuePress 1.4.0">
    
    <meta property="article:published_time" content="2020-03-23T21:46:11.000Z"><meta property="article:modified_time" content="2020-12-29T12:42:45.000Z"><meta property="og:site_name" content="KKXiao的blog"><meta property="og:title" content="类继承"><meta property="og:type" content="website"><meta property="og:url" content="/article/JS%E8%BF%9B%E9%98%B6/%E6%B5%85%E8%B0%88js%E7%BB%A7%E6%89%BF.html"><meta name="twitter:title" content="类继承"><meta name="twitter:url" content="/article/JS%E8%BF%9B%E9%98%B6/%E6%B5%85%E8%B0%88js%E7%BB%A7%E6%89%BF.html"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:label2" content="Filed under"><meta name="twitter:data2" content="JavaScript基础"><meta property="article:tag" content="JavaScript基础">
    <link rel="preload" href="/assets/css/0.styles.995b2171.css" as="style"><link rel="preload" href="/assets/js/app.147e99bc.js" as="script"><link rel="preload" href="/assets/js/2.ad5c180c.js" as="script"><link rel="preload" href="/assets/js/11.e70c8dd1.js" as="script"><link rel="preload" href="/assets/js/5.93843b06.js" as="script"><link rel="prefetch" href="/assets/js/10.07252ba1.js"><link rel="prefetch" href="/assets/js/12.1c68520d.js"><link rel="prefetch" href="/assets/js/13.306fd521.js"><link rel="prefetch" href="/assets/js/3.81b15fc0.js"><link rel="prefetch" href="/assets/js/4.ad3c6afc.js"><link rel="prefetch" href="/assets/js/6.fcf70fcc.js"><link rel="prefetch" href="/assets/js/7.bb77d12c.js"><link rel="prefetch" href="/assets/js/8.f159ce04.js"><link rel="prefetch" href="/assets/js/9.bb9f2b53.js">
    <link rel="stylesheet" href="/assets/css/0.styles.995b2171.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">KKXiao的blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/article/" class="nav-link router-link-active">
  文章目录
</a></div><div class="nav-item"><a href="/article/1.html" class="nav-link">
  算法与数据结构
</a></div><div class="nav-item"><a href="/article/2.html" class="nav-link">
  设计模式
</a></div><div class="nav-item"><a href="https://github.com/kkxiaoa" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/article/" class="nav-link router-link-active">
  文章目录
</a></div><div class="nav-item"><a href="/article/1.html" class="nav-link">
  算法与数据结构
</a></div><div class="nav-item"><a href="/article/2.html" class="nav-link">
  设计模式
</a></div><div class="nav-item"><a href="https://github.com/kkxiaoa" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/article/" class="sidebar-link">文章目录</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JS进阶</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/article/JS进阶/浅谈js对象.html" class="sidebar-link">《你不知道的JavaSript》之对象</a></li><li><a href="/article/JS进阶/浅谈js深拷贝.html" class="sidebar-link">浅谈js深拷贝</a></li><li><a href="/article/JS进阶/浅谈js继承.html" class="active sidebar-link">类继承</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/article/JS进阶/浅谈js继承.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/article/JS进阶/浅谈js继承.html#javascript-中的-类" class="sidebar-link">JavaScript 中的 “类”</a></li><li class="sidebar-sub-header"><a href="/article/JS进阶/浅谈js继承.html#类式继承" class="sidebar-link">类式继承</a></li><li class="sidebar-sub-header"><a href="/article/JS进阶/浅谈js继承.html#构造函数继承" class="sidebar-link">构造函数继承</a></li><li class="sidebar-sub-header"><a href="/article/JS进阶/浅谈js继承.html#原型式继承" class="sidebar-link">原型式继承</a></li><li class="sidebar-sub-header"><a href="/article/JS进阶/浅谈js继承.html#寄生组合式继承" class="sidebar-link">寄生组合式继承</a></li><li class="sidebar-sub-header"><a href="/article/JS进阶/浅谈js继承.html#多继承" class="sidebar-link">多继承</a></li></ul></li><li><a href="/article/JS进阶/浅谈js之this.html" class="sidebar-link">《你不知道的JavaSript》之this</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue深入浅出</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>对于科班出身的同学来讲，绝大多数应该是从 <code>过程化编程</code> 起步，这种风格的代码只包含了过程（函数）调用，没有对基层进行抽象（面条式代码）。</p> <p>后来我们开始接触到面向对象编程，进而又跟另外一个被称为 <code>类</code> 的术语扯上了关系，或者可以说是面向类式编程。</p> <p>在后来随着编程的深入我们开始接触到 <code>函数式编程</code>，这也是一种编程的选择或者习惯。</p> <p>但我们此次只讨论一下关于类的那些事儿。说到类，自然会想起类的三大基本特性 <code>封装</code> 、<code>继承</code> 、<code>多态</code>，而我们此次的主题便是 <code>继承</code>。</p> <h2 id="javascript-中的-类"><a href="#javascript-中的-类" class="header-anchor">#</a> JavaScript 中的 “类”</h2> <p>相较于传统语言，JavaScript 中一直在模仿类行为。直到 ES6 版本出来后才出现了一些近似类的功能，如 <code>class</code>、<code>extends</code> 、<code>super</code>。但是这并不代表 JavaScript 实现了像传统语言一样的类，JavaScript 的核心机制是<code>[[prototype]]</code>，并且只有对象，对象只负责定义自身的行为。像这些新定义的语法只是在原型链的基础上进行的封装（语法糖），因此搞懂<code>[[prototype]]</code> 才是关键。</p> <p>说了一些题外话，然后进入主题。我们先来抛出两个小问题：</p> <ul><li>如何实现继承？</li> <li>继承都有那些方法，它们的利弊都是什么？</li></ul> <p>接下来我们一个个的讲。</p> <h2 id="类式继承"><a href="#类式继承" class="header-anchor">#</a> 类式继承</h2> <p>先看一下例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Animal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>categories <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;二哈&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;英短&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;龙猫&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">Animal</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">category</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>categories<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> <span class="token function-variable function">animal</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
animal<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> animal1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">animal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
animal1<span class="token punctuation">.</span><span class="token function">category</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ['二哈', '英短', '龙猫'];</span>
</code></pre></div><p>这是最基本的类式继承，通过使用父级的构造函数调用来为 <code>animal.prototype</code> 进行关联。我们先来说一下使用构造函数调用（new）时会自动执行的一些情况：</p> <ol><li>创建（构造）一个新对象。</li> <li>这个新对象会被执行<code>[[Prototype]]</code>关联，也就是说这个对新象会关联到<code>animal.prototype</code>对象上。</li> <li>这个新对象会绑定到函数调用的<code>this</code>，也就是说此时的<code>this</code>指的是 <code>animal</code>。</li> <li>如果函数未返回其它对象，那么使用 <code>new</code> 关键字调用函数后会返回这个新对象（也就是 <code>animal{}</code>）。</li></ol> <p>关于<code>this</code> 更细致的讨论可以参见<a href="/article/JS进阶/浅谈js之this.html">你不知道的 js 之 this</a></p> <p>所以当我们执行 <code>animal1.category()</code> 操作的时候，因为 <code>[[Get]]</code> 操作的默认行为会检查原型链，<code>animal1</code>自身没有 <code>categories</code> 属性所以会到自身原型链查找，由于<code>new Animal()</code>操作返回的对象与<code>Animal.prototype</code> 自动关联并且<code>animal.prototype</code> 保存着 <code>Animal.prototype</code> 引用，因此<code>animal1</code> 便可以顺利的访问到<code>Animal</code> 原型链上的属性和方法以及自身的属性。</p> <p>我们再来看一下例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Animal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>categories <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;二哈&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;英短&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;龙猫&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token function-variable function">animal</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
animal<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> animal1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">animal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> animal2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">animal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>animal1<span class="token punctuation">.</span>categories<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [&quot;二哈&quot;, &quot;英短&quot;, &quot;龙猫&quot;]</span>
animal1<span class="token punctuation">.</span>categories<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;柯基&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>animal2<span class="token punctuation">.</span>categories<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [&quot;二哈&quot;, &quot;英短&quot;, &quot;龙猫&quot;, '柯基']</span>
</code></pre></div><p>通过这个例子就可以很明显的看出使用类式继承的问题：</p> <ul><li>如果父级的构造函数（使用 new 调用）里存在通过<code>this</code> 添加引用类型对象，当这个对象被更改时，所有子级都会受到牵连。</li> <li>因为是使用了父级的构造函数调用，子级对象就无法实例化自己的属性。</li></ul> <p>针对于这些问题我们引出了另外一种继承。</p> <h2 id="构造函数继承"><a href="#构造函数继承" class="header-anchor">#</a> 构造函数继承</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Animal</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>features <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;装傻卖萌&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;好吃懒做&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">Animal</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sleep</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot;正在睡觉&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Dog</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> voice</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">Animal</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>voice <span class="token operator">=</span> voice<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> dog1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token string">&quot;二哈&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;汪汪。。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> dog2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token string">&quot;柯基&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;汪汪。。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

dog1<span class="token punctuation">.</span>features<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;拆家小分队&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dog1<span class="token punctuation">.</span>features<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [&quot;装傻卖萌&quot;, &quot;好吃懒做&quot;, &quot;拆家小分队&quot;]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dog2<span class="token punctuation">.</span>features<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [&quot;装傻卖萌&quot;, &quot;好吃懒做&quot;]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dog1<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// TypeError: sleep is not a function</span>
</code></pre></div><p>前面我们有讲到通过构造函数调用时发生的情况，由于未执行原型链关联，所以当执行完构造函数调用后自动将 <code>this</code> 关联到 <code>Dog</code> 并为其添加属性。这段代码的核心是 <code>Animal.call(this, name)</code> ，这里通过<strong>显示</strong>绑定将 <code>Animal</code> 中的属性重新添加到 <code>Dog</code> 对象中。</p> <blockquote><p>提醒： <code>Animal.call</code> 和 <code>Animal.apply</code> 用法相同，都会更改当前执行上下文环境的 this，这种方式称为<code>this</code>显示绑定。还有一种被称为硬绑定的方法: <code>bind</code> ，同样会更改执行上下文环境的 this，但 <code>bind</code> 会返回执行函数的一个副本。</p></blockquote> <p>那既然这两种都不能实现一个完整的继承过程，我们可以结合一下这两种思想，使用构造函数将父级的公有属性与子级的公有属性进行合并，同时要将父级原型链上属性也进行合并（子级的公有属性要后执行）。此外，不要直接执行父级的构造函数，因为使用 <code>call</code> 已经执行了调用了构造函数，再使用 <code>new</code> 操作相当于执行了两遍重复的操作。</p> <h2 id="原型式继承"><a href="#原型式继承" class="header-anchor">#</a> 原型式继承</h2> <p>最早提出的这一方式的是美国的道格拉斯·克罗克福德（Douglas Crockford），同时也是<code>JSON</code> 的创立者。他提出的这个方案：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">inheritObject</span><span class="token punctuation">(</span><span class="token parameter">proto</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token constant">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token class-name">F</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> proto<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这段代码使用了一个一次性函数，通过改写它的 <code>.prototy</code> 将它指向想要关联的对象，然后再使用 <code>new</code> 操作构造一个新对象进行关联。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Animal</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">Animal</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sleep</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot;正在睡觉。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Dog</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> voice</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">Animal</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>voice <span class="token operator">=</span> voice<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">Dog</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token function">inheritObject</span><span class="token punctuation">(</span><span class="token class-name">Animal</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Dog</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">yell</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot;： &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>voice<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> dog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token string">&quot;二哈&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;汪汪。。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

dog<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 二哈正在睡觉。</span>
dog<span class="token punctuation">.</span><span class="token function">yell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 二哈： 汪汪。。</span>
</code></pre></div><p>需要注意一点：经过 <code>inheritObject</code> 后已经没有 <code>Dog.prototype.constructor</code> 属性了，因为<code>Dog.prototype</code> 指向的是 <code>Animal.prototype</code> ，所以如果还需要这个属性，需要手动修复它：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token class-name">Dog</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> Dog<span class="token punctuation">;</span>
</code></pre></div><h2 id="寄生组合式继承"><a href="#寄生组合式继承" class="header-anchor">#</a> 寄生组合式继承</h2> <p>因此便出现了更加理想的继承方式：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">inheritPrototype</span><span class="token punctuation">(</span><span class="token parameter">subClass<span class="token punctuation">,</span> superClass</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> f <span class="token operator">=</span> <span class="token function">inheritObject</span><span class="token punctuation">(</span>superClass<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>
  f<span class="token punctuation">.</span>constructor <span class="token operator">=</span> subClass<span class="token punctuation">;</span>
  subClass<span class="token punctuation">.</span>prototype <span class="token operator">=</span> f<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Animal</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">Animal</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sleep</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot;正在睡觉。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Dog</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> voice</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">Animal</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>voice <span class="token operator">=</span> voice<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 不考虑 construstor 指向的时候：</span>
<span class="token comment">// Dog.prototype = inheritObject(Animal.prototype);</span>
<span class="token comment">// 或者 Dog.prototype = Object.create(Animal.prototype)</span>

<span class="token comment">// 考虑 construstor 指向的时候：</span>
<span class="token comment">// 使用Object.create后手动修复construstor: Dog.prototype.constructor = Animal</span>
<span class="token function">inheritPrototype</span><span class="token punctuation">(</span>Dog<span class="token punctuation">,</span> Animal<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 或者 Object.setPrototypeOf(Dog.prototype, Animal.prototype)</span>

<span class="token class-name">Dog</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">yell</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot;饿了： &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>voice<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> dog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token string">&quot;二哈&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;汪汪。。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

dog<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 二哈正在睡觉。</span>
dog<span class="token punctuation">.</span><span class="token function">yell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 二哈饿了： 汪汪。。</span>
</code></pre></div><p>随着这种方式的深入，后来 ES5 便出现了 <code>Object.create</code> 这个方法，当然这个方法内部还有很多附加功能，但是核心却是如此。但是这样会导致 <code>constructor</code> 指向错误，进而我们引出了 <code>inheritPrototype()</code> 方法修复其 <code>constructor</code> 指向的问题。同样，ES6 之后出现了<code>Object.setPrototypeOf(subProto, superProto)</code> ，这个方法实际上跟我们自己写的 <code>inheritPrototype()</code> 是类似的。</p> <blockquote><p>如果不考虑 <code>constructor</code> 指向错误问题及轻微性能损失（被丢弃 F 对象会在适当时机被 GC 回收掉），使用<code>Object.create</code>是完全没问题的。</p> <p>此外，<code>Obeject.create</code> 会创建一个拥有空原型连的对象，这个对象没有原型链，无法进行进行委托。这种特殊的空对象特别适合做为<code>字典</code>结构来存储数据。因此，该对象无法使用 <code>instanceof</code> 关键字，并且在使用<code>for..in</code>遍历对象的时候，使用 <code>Object.prototype.hasOwnProperty.call</code> 来避免类型错误。</p></blockquote> <h2 id="多继承"><a href="#多继承" class="header-anchor">#</a> 多继承</h2> <p>对于多继承来讲，我们可以换个思路。我们刚刚将到，单一方式最完善的继承是寄生组合式，其实多继承完全可以照这个思路将多个类的公有属性通过 <code>call</code> 或着 <code>apply</code> 的重新绑定功能将属性拷贝到自身，而对于原型链上的属性，则可以使用原型继承（需要将其它类的原型进行<code>混入</code>）。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">SuperClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;SuperClass&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">SuperClass</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">superMethod</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ..</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">OtherSuperClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>otherName <span class="token operator">=</span> <span class="token string">&quot;OtherSuperClass&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">OtherSuperClass</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">otherSuperMethod</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ..</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">SuperClass</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">OtherSuperClass</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 混入原型对象</span>

Object<span class="token punctuation">.</span><span class="token function">setPrototypeOf</span><span class="token punctuation">(</span><span class="token class-name">SuperClass</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token class-name">OtherSuperClass</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>
Object<span class="token punctuation">.</span><span class="token function">setPrototypeOf</span><span class="token punctuation">(</span><span class="token class-name">MyClass</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token class-name">SuperClass</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">MyClass</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">myMethod</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;myMethod&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> myClass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myClass<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// MyClass {name: &quot;SuperClass&quot;, otherName: &quot;OtherSuperClass&quot;}</span>
</code></pre></div> <div id="gitalk-container"></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/29/2020, 8:42:45 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/article/JS进阶/浅谈js深拷贝.html" class="prev">
        浅谈js深拷贝
      </a></span> <span class="next"><a href="/article/JS进阶/浅谈js之this.html">
        《你不知道的JavaSript》之this
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.147e99bc.js" defer></script><script src="/assets/js/2.ad5c180c.js" defer></script><script src="/assets/js/11.e70c8dd1.js" defer></script><script src="/assets/js/5.93843b06.js" defer></script>
  </body>
</html>
